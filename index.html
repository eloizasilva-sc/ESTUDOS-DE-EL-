<!doctype html>
<html lang="pt-BR" class="h-full">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Concursada 2026 - Dashboard Profissional</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800;900&family=Open+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    body { box-sizing: border-box; font-family: 'Open Sans', sans-serif; }
    .font-heading { font-family: 'Montserrat', sans-serif; }

    .scrollbar-thin::-webkit-scrollbar { width: 8px; height: 8px; }
    .scrollbar-thin::-webkit-scrollbar-track { background: #f1f5f9; border-radius: 4px; }
    .scrollbar-thin::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
    .scrollbar-thin::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes slideIn { from { transform: translateX(-20px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
    @keyframes scaleIn { from { transform: scale(0.95); opacity: 0; } to { transform: scale(1); opacity: 1; } }

    .fade-in { animation: fadeIn 0.5s ease-out; }
    .slide-in { animation: slideIn 0.5s ease-out; }
    .scale-in { animation: scaleIn 0.4s ease-out; }

    .card-shadow { box-shadow: 0 2px 8px rgba(0,0,0,0.06); transition: all 0.3s ease; }
    .card-shadow:hover { box-shadow: 0 8px 24px rgba(0,0,0,0.12); transform: translateY(-2px); }

    .navy-gradient { background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 100%); }

    input[type="checkbox"] { width: 20px; height: 20px; accent-color: #1e3a8a; cursor: pointer; transition: all 0.2s ease; }
    input[type="checkbox"]:hover { transform: scale(1.15); }

    .metric-card { background: white; border-radius: 16px; padding: 24px; transition: all 0.3s ease; }
    .metric-card:hover { transform: translateY(-4px); box-shadow: 0 12px 32px rgba(0,0,0,0.1); }

    .tab-btn { transition: all 0.3s ease; position: relative; }
    .tab-btn::after { content: ''; position: absolute; bottom: 0; left: 0; width: 0; height: 3px; background: linear-gradient(90deg, #D4AF37 0%, #F4E4A6 100%); transition: width 0.3s ease; }
    .tab-btn.active::after { width: 100%; }

    .method-checkbox {
      display: flex; align-items: center; gap: 12px; padding: 12px 16px;
      background: white; border: 2px solid #e5e7eb; border-radius: 12px;
      cursor: pointer; transition: all 0.2s ease;
    }
    .method-checkbox:hover { border-color: #1e3a8a; background: #f9fafb; }
    .method-checkbox.checked { border-color: #059669; background: #ecfdf5; }
    .method-checkbox input[type="checkbox"] { width: 20px; height: 20px; accent-color: #059669; }

    .revision-cell { cursor: pointer; transition: all 0.2s ease; }
    .revision-cell:hover { transform: scale(1.05); }

    .folder-tab { transition: all 0.2s ease; }
    .folder-tab.active { background: #111827; color: #fff; }
    .folder-item-row:hover { background: #f8fafc; }
    .soft-ring:focus { outline: none; box-shadow: 0 0 0 4px rgba(30,58,138,0.18); border-color: #1e3a8a; }

    .mini-badge {
      display:inline-flex; align-items:center; gap:.35rem;
      padding:.15rem .5rem; border-radius:999px;
      font-weight:800; font-size:11px;
      background:#eef2ff; color:#3730a3;
    }
  </style>
</head>

<body class="h-full bg-gray-50">
  <div id="app" class="min-h-full w-full flex flex-col scrollbar-thin">

    <header class="flex-shrink-0 bg-white border-b-2 border-gray-200 px-8 py-6 fade-in">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-6">
          <div class="flex-1">
            <h1 id="mission-title" class="text-4xl font-heading font-black text-gray-900 tracking-tight">CONCURSADA 2026</h1>
            <p id="mission-motto" class="text-base text-gray-600 font-semibold mt-1">üéØ Rumo √† Aprova√ß√£o</p>
          </div>
        </div>

        <div class="flex gap-3 bg-gray-100 rounded-xl p-2 flex-wrap">
          <div id="mission-tabs-container" class="flex gap-3 flex-wrap"></div>
          <button onclick="openNewMissionModal()" class="px-6 py-4 bg-gradient-to-r from-green-600 to-green-700 text-white rounded-lg text-sm font-bold transition-all hover:opacity-90 shadow-md flex items-center gap-2">
            + NOVA MISS√ÉO
          </button>
        </div>
      </div>
    </header>

    <div class="flex-1 flex flex-col overflow-hidden">
      <main class="flex-1 flex flex-col overflow-hidden p-8">

        <div class="flex-shrink-0 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
          <div class="metric-card card-shadow scale-in">
            <div class="text-gray-600 text-sm font-semibold mb-2">Taxa de Sucesso</div>
            <div id="success-rate" class="text-4xl font-heading font-black text-gray-900 mb-1">0%</div>
            <div class="text-xs text-gray-500">Acertos / Total</div>
          </div>

          <div class="metric-card card-shadow scale-in">
            <div class="text-gray-600 text-sm font-semibold mb-2">Horas de Estudo</div>
            <div id="study-hours" class="text-4xl font-heading font-black text-gray-900 mb-1">0h</div>
            <div class="text-xs text-gray-500">√öltimos 7 dias (tempo registrado)</div>
          </div>

          <div class="metric-card card-shadow scale-in">
            <div class="text-gray-600 text-sm font-semibold mb-2">Patente Atual</div>
            <div id="current-rank" class="text-4xl font-heading font-black text-gray-900 mb-1">üéñÔ∏è</div>
            <div class="text-xs text-gray-500">Dias verdes + % acertos + tempo</div>
          </div>

          <div class="metric-card card-shadow scale-in">
            <div class="text-gray-600 text-sm font-semibold mb-2">Pomodoro</div>
            <div id="pomodoro-count" class="text-4xl font-heading font-black text-gray-900 mb-3">0</div>
            <button onclick="setModule('pomodoro')" class="w-full py-3 bg-gradient-to-r from-orange-500 to-red-500 text-white rounded-xl font-bold hover:opacity-90 transition-all shadow-lg text-sm">
              ABRIR TIMER
            </button>
          </div>
        </div>

        <div class="flex-1 flex gap-6 overflow-hidden">
          <div class="w-80 flex-shrink-0 bg-white rounded-2xl card-shadow flex flex-col overflow-hidden">
            <div class="p-4 border-b border-gray-200 bg-gradient-to-r from-blue-900 to-blue-800 text-white">
              <div class="flex items-center justify-between mb-3">
                <button onclick="changeCalendarMonth(-1)" class="p-2 hover:bg-white/20 rounded-lg transition-all">‚Äπ</button>
                <div class="flex flex-col items-center">
                  <h3 id="calendar-month-year" class="text-xl font-heading font-bold">Janeiro 2026</h3>
                  <div class="text-xs text-white/80 font-semibold" id="calendar-subtitle">Dias verdes: 0</div>
                </div>
                <button onclick="changeCalendarMonth(1)" class="p-2 hover:bg-white/20 rounded-lg transition-all">‚Ä∫</button>
              </div>
              <div class="grid grid-cols-7 gap-1 text-center text-xs font-bold">
                <div class="text-red-300">D</div><div>S</div><div>T</div><div>Q</div><div>Q</div><div>S</div><div class="text-red-300">S</div>
              </div>
            </div>
            <div class="flex-1 overflow-auto scrollbar-thin p-4">
              <div id="calendar-grid" class="grid grid-cols-7 gap-1"></div>
            </div>
            <div class="p-4 border-t border-gray-200 bg-gray-50 flex gap-3">
              <button onclick="goToToday()" class="flex-1 py-2 bg-blue-900 text-white rounded-lg font-bold hover:bg-blue-800 transition-all text-sm">üìÖ HOJE</button>
              <button onclick="quickToggleCalendarLegend()" class="px-4 py-2 bg-white border-2 border-gray-200 rounded-lg font-bold text-gray-700 hover:bg-gray-100 transition-all text-sm">‚ÑπÔ∏è</button>
            </div>
          </div>

          <div class="flex-1 bg-white rounded-2xl card-shadow flex flex-col overflow-hidden slide-in">
            <div class="p-6 border-b border-gray-200">
              <div class="flex items-center justify-between">
                <h2 class="text-2xl font-heading font-bold text-gray-900">üìö Centro de Estudos</h2>
                <div class="flex gap-3">
                  <button onclick="openDisciplineModal()" class="px-6 py-3 navy-gradient text-white rounded-xl font-bold hover:opacity-90 transition-all">+ DISCIPLINA</button>
                </div>
              </div>
              <div class="text-xs text-gray-500 mt-2">
                Agora cada pasta tem um campo de tempo (min). Isso alimenta o painel e sincroniza se o conte√∫do for sincronizado.
              </div>
            </div>

            <div class="flex-1 overflow-auto scrollbar-thin p-6" id="content-area"></div>
          </div>
        </div>
      </main>

      <footer class="flex-shrink-0 bg-gray-900 text-white py-4 px-8 text-center">
        <p class="text-sm font-semibold">Desenvolvido por <span class="text-yellow-400 font-bold">Eloiza Silva</span></p>
      </footer>
    </div>

    <!-- Discipline Modal -->
    <div id="discipline-modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden items-center justify-center p-4">
      <div class="bg-white rounded-2xl p-8 w-full max-w-md scale-in">
        <h3 class="text-2xl font-heading font-bold text-gray-900 mb-6">üìö Nova Disciplina</h3>

        <div class="space-y-5">
          <div>
            <label class="block text-sm text-gray-700 mb-2 font-semibold">Nome da Disciplina</label>
            <input type="text" id="discipline-name" class="w-full px-4 py-3 bg-gray-50 border-2 border-gray-200 rounded-xl soft-ring transition-all text-gray-900" placeholder="Ex: Direito Constitucional">
          </div>

          <div class="pt-4 border-t border-gray-200">
            <label class="flex items-center gap-3 cursor-pointer p-3 bg-blue-50 rounded-xl hover:bg-blue-100 transition-all">
              <input type="checkbox" id="copy-to-other-mission" class="w-5 h-5 rounded accent-color-blue-900">
              <div>
                <div class="text-sm font-bold text-gray-900">üîÑ Sincronizar entre miss√µes</div>
                <div class="text-xs text-gray-600">Espelha conte√∫dos, avalia√ß√µes e tempo</div>
              </div>
            </label>
          </div>
        </div>

        <div class="flex gap-4 mt-8">
          <button onclick="closeDisciplineModal()" class="flex-1 py-3 bg-gray-100 hover:bg-gray-200 rounded-xl font-bold transition-all text-gray-700">CANCELAR</button>
          <button onclick="saveDiscipline()" class="flex-1 py-3 navy-gradient text-white rounded-xl font-bold hover:opacity-90 transition-all">CONFIRMAR</button>
        </div>
      </div>
    </div>

    <!-- Content Modal -->
    <div id="content-modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden items-center justify-center p-4">
      <div class="bg-white rounded-2xl p-8 w-full max-w-2xl scale-in max-h-[90%] overflow-auto scrollbar-thin">
        <div class="flex items-center justify-between mb-6">
          <h3 class="text-2xl font-heading font-bold text-gray-900">üìù Nova Pasta (Conte√∫do)</h3>
          <button onclick="closeContentModal()" class="p-2 hover:bg-gray-100 rounded-lg transition-all" aria-label="Fechar">‚úï</button>
        </div>

        <div class="grid grid-cols-2 gap-5 mb-6">
          <div class="col-span-2">
            <label class="block text-sm text-gray-700 mb-2 font-semibold">Conte√∫do/Pasta</label>
            <input type="text" id="content-name" class="w-full px-4 py-3 bg-gray-50 border-2 border-gray-200 rounded-xl soft-ring transition-all text-gray-900" placeholder="Ex: Controle de Constitucionalidade">
          </div>

          <div>
            <label class="block text-sm text-gray-700 mb-2 font-semibold">Data do Estudo</label>
            <input type="date" id="content-date" class="w-full px-4 py-3 bg-gray-50 border-2 border-gray-200 rounded-xl soft-ring transition-all text-gray-900">
          </div>

          <!-- NOVO CAMPO: TEMPO -->
          <div>
            <label class="block text-sm text-gray-700 mb-2 font-semibold">Tempo estudado (min)</label>
            <input type="number" id="content-time-min" class="w-full px-4 py-3 bg-gray-50 border-2 border-gray-200 rounded-xl soft-ring transition-all text-gray-900" min="0" value="0" placeholder="Ex: 60">
          </div>
        </div>

        <div class="flex gap-4">
          <button onclick="closeContentModal()" class="flex-1 py-3 bg-gray-100 hover:bg-gray-200 rounded-xl font-bold transition-all text-gray-700">CANCELAR</button>
          <button onclick="saveContent()" class="flex-1 py-3 navy-gradient text-white rounded-xl font-bold hover:opacity-90 transition-all">üíæ SALVAR</button>
        </div>
      </div>
    </div>

    <!-- New Mission Modal (simplificado) -->
    <div id="new-mission-modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden items-center justify-center p-4">
      <div class="bg-white rounded-2xl p-8 w-full max-w-md scale-in">
        <h3 class="text-2xl font-heading font-bold text-gray-900 mb-6">üéØ Nova Miss√£o</h3>
        <div class="space-y-5">
          <div>
            <label class="block text-sm text-gray-700 mb-2 font-semibold">Nome da Miss√£o</label>
            <input type="text" id="new-mission-name" class="w-full px-4 py-3 bg-gray-50 border-2 border-gray-200 rounded-xl soft-ring transition-all text-gray-900" placeholder="Ex: TJ-RN">
          </div>
        </div>
        <div class="flex gap-4 mt-8">
          <button onclick="closeNewMissionModal()" class="flex-1 py-3 bg-gray-100 hover:bg-gray-200 rounded-xl font-bold transition-all text-gray-700">CANCELAR</button>
          <button onclick="saveNewMission()" class="flex-1 py-3 navy-gradient text-white rounded-xl font-bold hover:opacity-90 transition-all">CRIAR</button>
        </div>
      </div>
    </div>

    <div id="toast-container" class="fixed bottom-6 right-6 z-[100] space-y-3"></div>
  </div>

<script>
"use strict";

/* =========================================================
   STORAGE + STATE
========================================================= */
const STORAGE_KEY = "concursada2026_data";
let allData = [];
let currentModule = null;
let currentDisciplineId = null;

// Calendar
let currentCalendarMonth = 0;
let currentCalendarYear = 2026;
let calendarMutationLock = false;

// UI
let uiScheduled = false;

function genId(prefix){ return `${prefix}_${Date.now()}_${Math.random().toString(36).slice(2,10)}`; }
function normKey(s){ return (s||"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").trim().toLowerCase(); }

function saveToLocalStorage(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(allData)); }
function loadFromLocalStorage(){
  try { allData = JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]"); }
  catch { allData = []; }
}
function scheduleUI(){
  if (uiScheduled) return;
  uiScheduled = true;
  requestAnimationFrame(() => { uiScheduled = false; updateUI(); });
}
function createRecord(record){
  if(!record.__backendId) record.__backendId = genId("record");
  allData.push(record);
  saveToLocalStorage();
  scheduleUI();
  return record;
}
function updateRecord(record){
  const idx = allData.findIndex(r => r.__backendId === record.__backendId);
  if (idx !== -1) {
    allData[idx] = { ...allData[idx], ...record };
    saveToLocalStorage();
    scheduleUI();
  }
}
function deleteRecord(record){
  const idx = allData.findIndex(r => r.__backendId === record.__backendId);
  if (idx !== -1) {
    allData.splice(idx, 1);
    saveToLocalStorage();
    scheduleUI();
  }
}

/* =========================================================
   INIT
========================================================= */
function init(){
  loadFromLocalStorage();

  const today = new Date();
  currentCalendarYear = today.getFullYear();
  currentCalendarMonth = today.getMonth();

  const missions = allData.filter(d => d.type === "mission");
  if (missions.length === 0) {
    createRecord({ type:"mission", module_id:"tce", name:"MISS√ÉO TCE-RN", icon:"‚öñÔ∏è", created_at:new Date().toISOString() });
    createRecord({ type:"mission", module_id:"prf", name:"MISS√ÉO PRF", icon:"üöî", created_at:new Date().toISOString() });
  }

  renderMissionTabs();
  const first = allData.find(d => d.type === "mission");
  setModule(first.module_id);
}

function updateUI(){
  renderMissionTabs();
  updateMetrics();
  renderContent();
  renderCalendar();
}

/* =========================================================
   MISSIONS
========================================================= */
function renderMissionTabs(){
  const container = document.getElementById("mission-tabs-container");
  const missions = allData.filter(d => d.type === "mission");
  container.innerHTML = missions.map(m => {
    const active = m.module_id === currentModule ? "bg-gray-900 text-white" : "text-gray-600 hover:text-gray-900";
    return `<button onclick="setModule('${m.module_id}')" class="tab-btn px-8 py-4 rounded-lg text-sm font-bold transition-all ${active}">${m.icon||"üéØ"} ${m.name}</button>`;
  }).join("");
}

function setModule(module){
  currentModule = module;
  scheduleUI();
}

function openNewMissionModal(){
  document.getElementById("new-mission-name").value = "";
  const modal = document.getElementById("new-mission-modal");
  modal.classList.remove("hidden"); modal.classList.add("flex");
}
function closeNewMissionModal(){
  const modal = document.getElementById("new-mission-modal");
  modal.classList.add("hidden"); modal.classList.remove("flex");
}
function saveNewMission(){
  const name = document.getElementById("new-mission-name").value.trim();
  if(!name){ showToast("‚ö†Ô∏è Digite o nome da miss√£o", "error"); return; }
  createRecord({ type:"mission", module_id: genId("mission"), name: name.toUpperCase(), icon:"üéØ", created_at:new Date().toISOString() });
  closeNewMissionModal();
}

/* =========================================================
   DISCIPLINES
========================================================= */
function openDisciplineModal(){
  document.getElementById("discipline-name").value = "";
  document.getElementById("copy-to-other-mission").checked = false;
  const modal = document.getElementById("discipline-modal");
  modal.classList.remove("hidden"); modal.classList.add("flex");
}
function closeDisciplineModal(){
  const modal = document.getElementById("discipline-modal");
  modal.classList.add("hidden"); modal.classList.remove("flex");
}
function saveDiscipline(){
  const name = document.getElementById("discipline-name").value.trim();
  if(!name){ showToast("‚ö†Ô∏è Digite o nome da disciplina", "error"); return; }
  const exists = allData.find(d => d.type==="discipline" && d.module===currentModule && normKey(d.name)===normKey(name));
  if(exists){ showToast("‚ö†Ô∏è J√° existe nesta miss√£o", "error"); return; }

  createRecord({ type:"discipline", name, color:"#1e3a8a", module: currentModule, created_at:new Date().toISOString() });
  closeDisciplineModal();
}

/* =========================================================
   CONTENT (COM TEMPO)
========================================================= */
function openContentModalForDiscipline(disciplineId){
  currentDisciplineId = disciplineId;
  document.getElementById("content-name").value = "";
  document.getElementById("content-date").value = "";
  document.getElementById("content-time-min").value = "0";

  const modal = document.getElementById("content-modal");
  modal.classList.remove("hidden"); modal.classList.add("flex");
}
function closeContentModal(){
  const modal = document.getElementById("content-modal");
  modal.classList.add("hidden"); modal.classList.remove("flex");
  currentDisciplineId = null;
}

function saveContent(){
  const name = document.getElementById("content-name").value.trim();
  const date = document.getElementById("content-date").value;
  const minutes = Math.max(0, parseInt(document.getElementById("content-time-min").value) || 0);

  if(!name){ showToast("‚ö†Ô∏è Digite o nome do conte√∫do", "error"); return; }
  if(!currentDisciplineId){ showToast("‚ö†Ô∏è Selecione uma disciplina", "error"); return; }

  createRecord({
    type:"content",
    module: currentModule,
    discipline_id: currentDisciplineId,
    content: name,
    study_date: date,
    study_minutes: minutes,   // <<<<<< AQUI EST√Å O TEMPO SALVO
    created_at: new Date().toISOString()
  });

  showToast("‚úÖ Pasta salva (com tempo)!", "success");
  closeContentModal();
}

function updateContentMinutes(contentId, value){
  const content = allData.find(c => c.__backendId === contentId);
  if(!content) return;
  const minutes = Math.max(0, parseInt(value)||0);
  updateRecord({ ...content, study_minutes: minutes });
}

function updateContentDate(contentId, value){
  const content = allData.find(c => c.__backendId === contentId);
  if(!content) return;
  updateRecord({ ...content, study_date: value });
}

/* =========================================================
   CONTENT RENDER (DATA + TEMPO)
========================================================= */
function renderContent(){
  const container = document.getElementById("content-area");
  const disciplines = allData.filter(d => d.type==="discipline" && d.module===currentModule);

  if(disciplines.length===0){
    container.innerHTML = `
      <div class="text-center py-20">
        <div class="text-7xl mb-4">üìö</div>
        <div class="text-xl font-bold text-gray-900 mb-2">Nenhuma disciplina cadastrada</div>
        <button onclick="openDisciplineModal()" class="px-8 py-4 navy-gradient text-white rounded-xl font-bold">+ DISCIPLINA</button>
      </div>`;
    return;
  }

  let html = `<div class="space-y-4">`;

  disciplines.forEach(disc => {
    const contents = allData.filter(c => c.type==="content" && c.discipline_id===disc.__backendId && c.module===currentModule);

    html += `
      <div class="bg-gray-50 rounded-xl p-6">
        <div class="flex items-center justify-between mb-4">
          <div class="flex items-center gap-3">
            <div class="w-3 h-3 rounded-full" style="background:${disc.color||"#1e3a8a"}"></div>
            <div class="font-bold text-gray-900 text-lg">${disc.name}</div>
            <div class="text-sm text-gray-500">(${contents.length} pastas)</div>
          </div>
          <button onclick="openContentModalForDiscipline('${disc.__backendId}')" class="px-4 py-2 bg-blue-600 text-white rounded-lg font-bold text-sm">+ Pasta</button>
        </div>

        ${contents.length===0 ? `<div class="text-gray-500 font-semibold py-6 text-center">Nenhuma pasta cadastrada.</div>` : `
          <div class="overflow-x-auto">
            <table class="w-full text-sm bg-white rounded-xl overflow-hidden">
              <thead class="bg-gray-100 border-b border-gray-200">
                <tr>
                  <th class="px-4 py-3 text-left font-bold text-gray-700">PASTA</th>
                  <th class="px-4 py-3 text-center font-bold text-gray-700">DATA</th>
                  <th class="px-4 py-3 text-center font-bold text-gray-700">TEMPO (min)</th>
                </tr>
              </thead>
              <tbody>
                ${contents.map(c => `
                  <tr class="border-t border-gray-100 hover:bg-gray-50">
                    <td class="px-4 py-3 font-semibold text-gray-900">${c.content}</td>
                    <td class="px-4 py-3 text-center">
                      <input type="date" value="${c.study_date||""}" onchange="updateContentDate('${c.__backendId}', this.value)"
                        class="w-36 bg-white border-2 border-gray-200 rounded-lg px-2 py-2 text-xs soft-ring">
                    </td>
                    <td class="px-4 py-3 text-center">
                      <input type="number" min="0" value="${c.study_minutes||0}" onchange="updateContentMinutes('${c.__backendId}', this.value)"
                        class="w-28 bg-white border-2 border-gray-200 rounded-lg px-2 py-2 text-xs soft-ring text-center font-bold">
                    </td>
                  </tr>
                `).join("")}
              </tbody>
            </table>
          </div>
        `}
      </div>
    `;
  });

  html += `</div>`;
  container.innerHTML = html;
}

/* =========================================================
   METRICS (usa study_minutes nos √∫ltimos 7 dias)
========================================================= */
function updateMetrics(){
  const contents = allData.filter(d => d.type==="content" && d.module===currentModule);

  const now = new Date();
  const sevenDaysAgo = new Date(now.getFullYear(), now.getMonth(), now.getDate() - 6);
  sevenDaysAgo.setHours(0,0,0,0);

  let totalMinutesWeek = 0;

  contents.forEach(c => {
    if (c.study_date) {
      const d = new Date(c.study_date + "T12:00:00");
      if (d >= sevenDaysAgo && d <= now) totalMinutesWeek += (c.study_minutes || 0);
    }
  });

  const h = Math.floor(totalMinutesWeek / 60);
  const m = totalMinutesWeek % 60;
  document.getElementById("study-hours").textContent = totalMinutesWeek ? `${h}h${m ? String(m).padStart(2,"0") : ""}` : "0h";

  document.getElementById("success-rate").textContent = "0%";
  document.getElementById("current-rank").textContent = "üéñÔ∏è";
}

/* =========================================================
   CALENDAR (simples)
========================================================= */
function renderCalendar(){
  const monthNames = ["Janeiro","Fevereiro","Mar√ßo","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"];
  document.getElementById("calendar-month-year").textContent = `${monthNames[currentCalendarMonth]} ${currentCalendarYear}`;

  const firstDay = new Date(currentCalendarYear, currentCalendarMonth, 1);
  const lastDay = new Date(currentCalendarYear, currentCalendarMonth + 1, 0);
  const daysInMonth = lastDay.getDate();
  const startingDayOfWeek = firstDay.getDay();

  const grid = [];
  for (let i=0; i<startingDayOfWeek; i++) grid.push(`<div class="aspect-square"></div>`);
  for (let day=1; day<=daysInMonth; day++){
    grid.push(`<div class="aspect-square bg-white border border-gray-200 rounded-lg flex items-center justify-center font-semibold text-gray-700">${day}</div>`);
  }
  document.getElementById("calendar-grid").innerHTML = grid.join("");
  document.getElementById("calendar-subtitle").textContent = `Dias verdes: 0`;
}
function changeCalendarMonth(delta){
  currentCalendarMonth += delta;
  if (currentCalendarMonth < 0) { currentCalendarMonth = 11; currentCalendarYear--; }
  if (currentCalendarMonth > 11) { currentCalendarMonth = 0; currentCalendarYear++; }
  renderCalendar();
}
function goToToday(){
  const today = new Date();
  currentCalendarYear = today.getFullYear();
  currentCalendarMonth = today.getMonth();
  renderCalendar();
}
function quickToggleCalendarLegend(){ showToast("Legenda: calend√°rio b√°sico nesta vers√£o.", "info", 2500); }

/* =========================================================
   TOAST
========================================================= */
function showToast(message, type="info", duration=3000){
  const container = document.getElementById("toast-container");
  const toast = document.createElement("div");
  const colors = { success:"bg-green-600", error:"bg-red-600", info:"bg-blue-900" };
  toast.className = `${colors[type]||colors.info} px-6 py-4 rounded-xl shadow-xl text-white font-bold scale-in`;
  toast.textContent = message;
  container.appendChild(toast);

  setTimeout(() => {
    toast.style.opacity = "0";
    toast.style.transition = "opacity 0.3s";
    setTimeout(() => toast.remove(), 300);
  }, duration);
}

/* =========================================================
   START
========================================================= */
if (document.readyState === "loading") document.addEventListener("DOMContentLoaded", init);
else init();
</script>

</body>
</html>
